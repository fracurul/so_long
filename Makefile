# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: fracurul <fracurul@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/06/06 17:17:09 by fracurul          #+#    #+#              #
#    Updated: 2024/07/01 19:38:37 by fracurul         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

#########################################
#                LIB NAME               #
#########################################

NAME = so_long
LIBFT = libft/libft.a
MLX42 = MLX42/build/libmlx42.a
MLX_INSTALL := mlx_install

#########################################
#              COMPILATOR               #
#########################################

CC = gcc

#########################################
#           COMPILATOR FLAGS            #
#########################################

FLAGS = -Wall -Wextra -Werror -fPIE
UBUNTU_FLAGS = -g -Iinclude -lglfw -lm -ldl -pthread -fPIE
SAN = -fsanitize=address -g3 -O3

#########################################
#           LIB FUNCTIONS               #
#########################################

SRC = src/game_utils.c src/map_utils.c src/utils.c src/map.c \
src/player_moves.c src/render.c src/main.c \

#########################################
#               OBJECTS                 #
#########################################

OBJ = $(patsubst src/%.c, $(ODIR)/%.o, $(SRC))

#########################################
#               OBJECTS                 #
#########################################

ODIR := odir

#########################################
#            CLEAN FUNCTION             #
#########################################

CLEAN = rm -rf

#########################################
#              COMPILE ALL              #
#########################################

all: $(NAME)

#########################################
#             INSTALL MLX42             #
#########################################

$(MLX_INSTALL):
	@echo "#########################################"
	@echo "#           Installing MLX42..          #"
	@echo "#########################################"
	@cd MLX42;\
	cmake -B build;\
	cmake --build build;\

#########################################
#            COMPILE SO_LONG            #
#########################################

$(NAME): $(OBJ) $(LIBFT) $(MLX42)
	@echo "#########################################"
	@echo "#          Compiling So_long..          #"
	@echo "#########################################"
	@$(CC) $(FLAGS) $^ $(UBUNTU_FLAGS) -o $@


#########################################
#             COMPILE MLX42             #
#########################################

$(MLX42):
	@echo "#########################################"
	@echo "#           Compiling MLX42..           #"
	@echo "#########################################"
	@$(MAKE) -s -C MLX42/build CFLAGS="$(FLAGS) -fPIC"

#########################################
#                 MKDIR                 #
#########################################

$(ODIR) :
	@mkdir -p $(ODIR)

#########################################
#             COMPILE LIBFT             #
#########################################

$(LIBFT):
	@echo "#########################################"
	@echo "#           Compiling LIBFT..           #"
	@echo "#########################################"
	@$(MAKE) -s -C libft/ CFLAGS="$(FLAGS) -fPIC"

#########################################
#           COMPILE .c to .o            #
#########################################

$(ODIR)/%.o : src/%.c | $(ODIR)
	$(CC) $(FLAGS) $(UBUNTU_FLAGS) -c $< -o $@

#########################################
#              DELETE .o                #
#########################################

clean:
	@$(MAKE) clean -s -C libft/
	@$(CLEAN) $(OBJ)
	@echo "files deleted"

#########################################
#              DELETE ALL               #
#########################################

fclean: clean
	@$(MAKE) fclean -s -C libft/
	@$(CLEAN) $(NAME) $(ODIR)
	@echo "program deleted"

#########################################
#         DELETE ALL & REMAKE           #
#########################################

re: fclean all

.PHONY: all re clean fclean
